<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <title>í•™ìŠµ í†µê³„</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="back-btn" onclick="location.href='index.html'">â† ë’¤ë¡œ</button>
            <h1>ğŸ“Š í•™ìŠµ í†µê³„</h1>
            <p>ë‚˜ì˜ í•™ìŠµ í˜„í™©</p>
        </div>

        <div class="stats-container">
            <!-- ì „ì²´ í†µê³„ -->
            <div class="stats-section">
                <h2>ğŸ“ˆ ì „ì²´ í†µê³„</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalWords">0ê°œ</div>
                        <div class="stat-label">í•™ìŠµí•œ ë‹¨ì–´</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalCorrect">0ê°œ</div>
                        <div class="stat-label">ì •ë‹µ ìˆ˜</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalAccuracy">0%</div>
                        <div class="stat-label">ì •ë‹µë¥ </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="completedLevels">0ê°œ</div>
                        <div class="stat-label">ì™„ë£Œí•œ ë ˆë²¨</div>
                    </div>
                </div>
            </div>

            <!-- IELTS ì§„í–‰ë¥  -->
            <div class="stats-section">
                <h2>ğŸ“˜ IELTS ì§„í–‰ë¥ </h2>
                <div class="difficulty-progress" id="ieltsProgress"></div>
            </div>

            <!-- TOPIK ì§„í–‰ë¥  -->
            <div class="stats-section">
                <h2>ğŸ“• TOPIK ì§„í–‰ë¥ </h2>
                <div class="difficulty-progress" id="topikProgress"></div>
            </div>

            <!-- ìì£¼ í‹€ë¦° ë‹¨ì–´ -->
            <div class="stats-section">
                <h2>âŒ ìì£¼ í‹€ë¦° ë‹¨ì–´ TOP 10</h2>
                <div class="mistake-list" id="mistakeList">
                    <div class="empty-state">ì•„ì§ í‹€ë¦° ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
                </div>
            </div>

            <!-- ë°ì´í„° ê´€ë¦¬ -->
            <div class="stats-section">
                <h2>ğŸ”§ ë°ì´í„° ê´€ë¦¬</h2>
                <div class="data-management">
                    <button class="reset-btn" onclick="resetAllData()">âš ï¸ ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™”</button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/storage.js"></script>
    <script>
        window.addEventListener('DOMContentLoaded', function() {
            loadProgressFromStorage();
            loadStatsFromStorage();
            updateStatsDisplay();
        });

        function updateStatsDisplay() {
            const totalAttempts = window.stats.totalAttempts || 0;
            const totalCorrect = window.stats.totalCorrect || 0;
            const accuracy = totalAttempts > 0 ? Math.round((totalCorrect / totalAttempts) * 100) : 0;
            const learnedWordsCount = Object.keys(window.stats.learnedWords || {}).length;
            
            document.getElementById('totalWords').textContent = learnedWordsCount + 'ê°œ';
            document.getElementById('totalCorrect').textContent = totalCorrect + 'ê°œ';
            document.getElementById('totalAccuracy').textContent = accuracy + '%';

            let completedLevels = 0;
            Object.keys(window.progress.levels).forEach(levelKey => {
                const level = window.progress.levels[levelKey];
                if (level.mcPassed && level.tpPassed) {
                    completedLevels++;
                }
            });
            document.getElementById('completedLevels').textContent = completedLevels + 'ê°œ';

            renderExamProgress('ielts', 'ieltsProgress');
            renderExamProgress('topik', 'topikProgress');

            const mistakeList = document.getElementById('mistakeList');
            const mistakes = Object.values(window.stats.mistakes || {})
                .sort((a, b) => b.count - a.count)
                .slice(0, 10);

            if (mistakes.length === 0) {
                mistakeList.innerHTML = '<div class="empty-state">ì•„ì§ í‹€ë¦° ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            } else {
                mistakeList.innerHTML = mistakes.map(mistake => `
                    <div class="mistake-item">
                        <div class="mistake-word">
                            <span class="english">${mistake.english}</span>
                            <span class="korean">${mistake.korean}</span>
                        </div>
                        <div class="mistake-count">${mistake.count}íšŒ</div>
                    </div>
                `).join('');
            }
        }

        function renderExamProgress(exam, containerId) {
            const container = document.getElementById(containerId);
            const examConfig = window.EXAM_CONFIG[exam];
            
            if (!examConfig) {
                container.innerHTML = '<div class="empty-state">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            container.innerHTML = '';
            
            const colors = {
                ielts: { 5: '#4CAF50', 6: '#2196F3', 7: '#9C27B0' },
                topik: { 12: '#FF9800', 34: '#FF5722', 56: '#E91E63', '6plus': '#9C27B0' }
            };

            Object.keys(examConfig.difficulties).forEach(difficulty => {
                const diffConfig = examConfig.difficulties[difficulty];
                const totalLevels = diffConfig.levels;
                
                let completed = 0;
                for (let i = 1; i <= totalLevels; i++) {
                    const levelKey = getLevelKey(exam, difficulty, i);
                    if (window.progress.levels[levelKey]) {
                        const level = window.progress.levels[levelKey];
                        if (level.mcPassed && level.tpPassed) {
                            completed++;
                        }
                    }
                }
                
                const percentage = Math.round((completed / totalLevels) * 100);
                const color = colors[exam][difficulty] || '#607D8B';
                
                const item = document.createElement('div');
                item.className = 'difficulty-progress-item';
                item.innerHTML = `
                    <div class="difficulty-progress-header">
                        <span class="difficulty-name">${examConfig.name} ${diffConfig.name}</span>
                        <span class="difficulty-percentage">${percentage}%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${percentage}%; background: ${color};"></div>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function resetAllData() {
            if (confirm('ì •ë§ë¡œ ëª¨ë“  í•™ìŠµ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                localStorage.clear();
                alert('ëª¨ë“  ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
                location.reload();
            }
        }

        window.addEventListener('error', function(e) {
            console.error('Error:', e.message, e.filename, e.lineno);
        });
        document.addEventListener('touchstart', function(){}, {passive: true});
    </script>
</body>
</html>
