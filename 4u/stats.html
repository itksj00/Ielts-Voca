<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•™ìŠµ í†µê³„</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="back-btn" onclick="location.href='index.html'">â† ë’¤ë¡œ</button>
            <h1>ğŸ“Š í•™ìŠµ í†µê³„</h1>
            <p>ë‚˜ì˜ í•™ìŠµ í˜„í™©</p>
        </div>

        <div class="stats-container">
            <!-- ì „ì²´ í†µê³„ -->
            <div class="stats-section">
                <h2>ğŸ“ˆ ì „ì²´ í†µê³„</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalWords">0ê°œ</div>
                        <div class="stat-label">í•™ìŠµí•œ ë‹¨ì–´</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalCorrect">0ê°œ</div>
                        <div class="stat-label">ì •ë‹µ ìˆ˜</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalAccuracy">0%</div>
                        <div class="stat-label">ì •ë‹µë¥ </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="completedLevels">0ê°œ</div>
                        <div class="stat-label">ì™„ë£Œí•œ ë ˆë²¨</div>
                    </div>
                </div>
            </div>

            <!-- ë‚œì´ë„ë³„ ì§„í–‰ë¥  -->
            <div class="stats-section">
                <h2>ğŸ“š ë‚œì´ë„ë³„ ì§„í–‰ë¥ </h2>
                <div class="difficulty-progress">
                    <div class="difficulty-progress-item">
                        <div class="difficulty-progress-header">
                            <span class="difficulty-name">IELTS Band 5</span>
                            <span class="difficulty-percentage" id="ielts5-percentage">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="ielts5-progress" style="width: 0%; background: #4CAF50;"></div>
                        </div>
                    </div>
                    <div class="difficulty-progress-item">
                        <div class="difficulty-progress-header">
                            <span class="difficulty-name">IELTS Band 6</span>
                            <span class="difficulty-percentage" id="ielts6-percentage">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="ielts6-progress" style="width: 0%; background: #2196F3;"></div>
                        </div>
                    </div>
                    <div class="difficulty-progress-item">
                        <div class="difficulty-progress-header">
                            <span class="difficulty-name">IELTS Band 7</span>
                            <span class="difficulty-percentage" id="ielts7-percentage">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="ielts7-progress" style="width: 0%; background: #9C27B0;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ìì£¼ í‹€ë¦° ë‹¨ì–´ -->
            <div class="stats-section">
                <h2>âŒ ìì£¼ í‹€ë¦° ë‹¨ì–´ TOP 10</h2>
                <div class="mistake-list" id="mistakeList">
                    <div class="empty-state">ì•„ì§ í‹€ë¦° ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
                </div>
            </div>

            <!-- ë°ì´í„° ê´€ë¦¬ -->
            <div class="stats-section">
                <h2>ğŸ”§ ë°ì´í„° ê´€ë¦¬</h2>
                <div class="data-management">
                    <button class="reset-btn" onclick="resetAllData()">âš ï¸ ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™”</button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/storage.js"></script>
    <script>
        window.addEventListener('DOMContentLoaded', function() {
            loadProgressFromStorage();
            loadStatsFromStorage();
            updateStatsDisplay();
        });

        function updateStatsDisplay() {
            // ì „ì²´ í†µê³„
            const totalAttempts = window.stats.totalAttempts || 0;
            const totalCorrect = window.stats.totalCorrect || 0;
            const accuracy = totalAttempts > 0 ? Math.round((totalCorrect / totalAttempts) * 100) : 0;
            
            // í•™ìŠµí•œ ë‹¨ì–´ ìˆ˜ ê³„ì‚° (learnedWords ì‚¬ìš©)
            const learnedWordsCount = Object.keys(window.stats.learnedWords || {}).length;
            
            document.getElementById('totalWords').textContent = learnedWordsCount + 'ê°œ';
            document.getElementById('totalCorrect').textContent = totalCorrect + 'ê°œ';
            document.getElementById('totalAccuracy').textContent = accuracy + '%';

            // ì™„ë£Œí•œ ë ˆë²¨ ê³„ì‚°
            let completedLevels = 0;
            ['ielts5', 'ielts6', 'ielts7'].forEach(diff => {
                for (let i = 1; i <= 10; i++) {
                    const levelKey = `${diff}-${i}`;
                    if (window.progress.levels[levelKey]) {
                        const level = window.progress.levels[levelKey];
                        if (level.mcPassed && level.tpPassed) {
                            completedLevels++;
                        }
                    }
                }
            });
            document.getElementById('completedLevels').textContent = completedLevels + 'ê°œ';

            // ë‚œì´ë„ë³„ ì§„í–‰ë¥ 
            ['ielts5', 'ielts6', 'ielts7'].forEach(diff => {
                let completed = 0;
                for (let i = 1; i <= 10; i++) {
                    const levelKey = `${diff}-${i}`;
                    if (window.progress.levels[levelKey]) {
                        const level = window.progress.levels[levelKey];
                        if (level.mcPassed && level.tpPassed) {
                            completed++;
                        }
                    }
                }
                const percentage = (completed / 10) * 100;
                document.getElementById(`${diff}-progress`).style.width = percentage + '%';
                document.getElementById(`${diff}-percentage`).textContent = Math.round(percentage) + '%';
            });

            // ìì£¼ í‹€ë¦° ë‹¨ì–´
            const mistakeList = document.getElementById('mistakeList');
            const mistakes = Object.values(window.stats.mistakes || {})
                .sort((a, b) => b.count - a.count)
                .slice(0, 10);

            if (mistakes.length === 0) {
                mistakeList.innerHTML = '<div class="empty-state">ì•„ì§ í‹€ë¦° ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            } else {
                mistakeList.innerHTML = mistakes.map(mistake => `
                    <div class="mistake-item">
                        <div class="mistake-word">
                            <span class="english">${mistake.english}</span>
                            <span class="korean">${mistake.korean}</span>
                        </div>
                        <div class="mistake-count">${mistake.count}íšŒ</div>
                    </div>
                `).join('');
            }
        }

        function resetAllData() {
            if (confirm('ì •ë§ë¡œ ëª¨ë“  í•™ìŠµ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                localStorage.clear();
                alert('ëª¨ë“  ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
                location.reload();
            }
        }
    </script>
</body>
</html>